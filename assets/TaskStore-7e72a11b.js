import{aJ as C,r as W,f as i}from"./index-036c5b23.js";import{d as t}from"./date-b88fde17.js";import{u as b,a as E}from"./GoalStore-937c0ff9.js";const A=C("TaskStore",()=>{const{data:o,refetch:m,getItem:v,createItem:D,updateItem:h,deleteItem:Y,getChanges:w,isChanged:I}=b("/tasks/"),s=E(),y=e=>(e.forEach(a=>{a.goalName=a.goal?s.getItem(a.goal).name:null}),e),n=W({done:!0,recurring:!0,goal:null});s.$onAction(({name:e,args:a})=>{e==="deleteItem"&&n.value.goal===a[0]&&(n.value.goal=null)});const d=e=>t.subtractFromDate(e,{days:t.getDayOfWeek(e)-1}),c=e=>t.formatDate(e,"YYYY-w"),g=t.startOfDate(new Date,"day"),f=d(g),S=c(g),T=i(()=>o.value&&s.data?y([...o.value]):null),l=i(()=>o.value?o.value.filter(e=>{if(!e.planned)return!1;const a=new Date(e.planned.slice(0,10))<f;return a&&n.value.done&&e.done||a&&n.value.recurring&&e.group_id?!1:!(n.value.goal&&!s.getBranch(n.value.goal).includes(e.goal))}).sort((e,a)=>Date.parse(e.planned)-Date.parse(a.planned)):null),k=i(()=>{const e=(a,r,u)=>{for(;r<=u;)a[c(r)]={day:t.formatDate(r,"YYYY-MM-DD"),tasks:[]},r=t.addToDate(r,{days:7});return a};if(l.value&&l.value.length){const a=new Date(l.value[0].planned.slice(0,10)),r=t.addToDate(new Date(l.value[l.value.length-1].planned.slice(0,10)),{days:7}),u=e({},d(a),d(r));return l.value.forEach(p=>{u[c(p.planned)].tasks.push(p)}),u}return e({},f,t.addToDate(f,{days:14}))});return{data:o,refetch:m,getItem:v,createItem:D,updateItem:h,deleteItem:Y,getChanges:w,isChanged:I,currentWeek:S,filter:n,relative:T,filtered:l,calendar:k}});export{A as u};
