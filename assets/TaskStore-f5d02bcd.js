import{af as _,j as f,r as j}from"./index-97b47257.js";import{d as l}from"./date-b913a0c9.js";import{a as A,u as B}from"./GoalStore-0a0ff43d.js";const N=_("TaskStore",()=>{const{data:u,refetch:y,getItem:I,createItem:T,updateItem:b,deleteItem:w}=A("/tasks/"),p=B(),S=f(()=>u.value&&p.data?u.value.map(e=>({...e,goalName:e.goal?p.getItem(e.goal).name:null})):null),o=j({show:!1,done:!1,recurring:!1,goal:null}),h=f(()=>o.value.goal?p.getBranch(o.value.goal):null);p.$onAction(({name:e,args:t})=>{e==="deleteItem"&&o.value.goal===t[0]&&(o.value.goal=null)});const s=e=>l.subtractFromDate(e,{days:l.getDayOfWeek(e)-1}),i=e=>l.formatDate(e,"YYYY-MM-DD"),v=l.startOfDate(new Date,"day"),g=s(v),Y=i(g),c=f(()=>u.value?u.value.filter(e=>!(!e.planned||new Date(e.planned.slice(0,10))<g&&(!o.value.done&&e.done||!o.value.recurring&&e.group_id)||h.value&&!h.value.includes(e.goal))).sort((e,t)=>Date.parse(e.planned)-Date.parse(t.planned)):null),x=f(()=>{const e=(t,r,d)=>{for(;r<=d;)t[i(r)]=[],r=l.addToDate(r,{days:7});return t};if(c.value&&c.value.length){const t=s(c.value[0].planned.slice(0,10)),r=l.addToDate(s(c.value[c.value.length-1].planned.slice(0,10)),{days:7}),d=e({},t,r);return c.value.forEach(m=>{d[i(s(m.planned.slice(0,10)))].push(m)}),d}return e({},g,l.addToDate(g,{days:14}))}),F=f(()=>{if(!u.value)return null;const e=l.subtractFromDate(v,{months:6}),t=u.value.filter(n=>{if(!n.group_id||!n.planned)return!1;const a=new Date(n.planned.slice(0,10));return!(a>v||a<e)}).sort((n,a)=>Date.parse(n.planned)-Date.parse(a.planned));if(!t.length)return null;const r=(n,a,D)=>{for(;a<=D;)n.push({x:i(a),y:null}),a=l.addToDate(a,{days:7});return n},d=n=>n.done?100:n.target>1?Math.round(n.performance/n.target*100):0,m=s(t[0].planned.slice(0,10)),O=s(t[t.length-1].planned.slice(0,10));return t.reduce((n,a)=>{n[a.name]=n[a.name]??r([],m,O);const D=i(s(a.planned.slice(0,10)));return n[a.name].find(W=>W.x===D).y=d(a),n},{})});return{data:u,refetch:y,getItem:I,createItem:T,updateItem:b,deleteItem:w,relative:S,filter:o,currentWeek:Y,filtered:c,calendar:x,recurring:F}});export{N as u};
