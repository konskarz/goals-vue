import{b as I,a as C,Q as E}from"./api.client-8b80e0fd.js";import{Q as O,_ as W}from"./WeekTimelineEntry-46c5ef9d.js";import{Q as B}from"./QPage-ac39312c.js";import{d as a}from"./date-d9f3626e.js";import{_ as G}from"./GoalSelect-aa5b57fa.js";import{r as w,f as k,o as L,w as N,a0 as p,a1 as c,a5 as s,a6 as D,a8 as S,ax as m,a9 as v,aa as $,ab as T,ay as b}from"./index-49fb2682.js";import"./QList-d9f22378.js";import"./format-348c4c7a.js";import"./QItemLabel-40afa097.js";import"./NumberInput-b2a87e4a.js";import"./DurationInput-b8c22a07.js";import"./QMenu-0c701d6d.js";const ae={__name:"CalendarView",setup(q){const i="Goal-Filter",n=new Date,M=a.subtractFromDate(n,{days:a.getDayOfWeek(n)-1}),h=a.formatDate(n,"YYYY-w"),o=w(null),g=w({done:!0,recurring:!0}),{data:F,mutate:Q}=I.read("/tasks/"),y=k(()=>F.value.filter(e=>{const t=new Date(e.planned).getDay()<M.getDay();return t&&g.value.done&&e.done||t&&g.value.recurring&&e.group_id?!1:!(o.value&&o.value!==e.goal)})),_=k(()=>{const e=y.value.length,t=e?[...y.value].sort((u,x)=>Date.parse(u.planned)-Date.parse(x.planned)):null,r=e?new Date(t[0].planned):n,d=e?new Date(t[t.length-1].planned):a.addToDate(r,{days:7}),Y=a.addToDate(d,{days:7});let l=a.subtractFromDate(r,{days:a.getDayOfWeek(r)-1});const V=a.subtractFromDate(Y,{days:a.getDayOfWeek(Y)-1});let f={};for(;l<=V;)f[a.formatDate(l,"YYYY-w")]={day:a.formatDate(l,"YYYY-MM-DD"),tasks:[]},l=a.addToDate(l,{days:7});return e&&t.forEach(u=>{f[a.formatDate(u.planned,"YYYY-w")].tasks.push(u)}),f});return L(()=>{const e=localStorage.getItem(i);e&&(o.value=parseInt(e))}),N(o,e=>{e?localStorage.setItem(i,e):localStorage.removeItem(i)}),(e,t)=>(s(),p(B,{padding:""},{default:c(()=>[D(E,null,{default:c(()=>[D(C,null,{default:c(()=>[S("Tasks")]),_:1}),D(G,{modelValue:o.value,"onUpdate:modelValue":t[0]||(t[0]=r=>o.value=r),label:"For Goal",dense:"",borderless:"",class:"col-6 col-sm-3 col-lg-2"},null,8,["modelValue"])]),_:1}),m(_)?(s(),p(O,{key:0,layout:"dense",class:"q-px-md"},{default:c(()=>[(s(!0),v(T,null,$(m(_),(r,d)=>(s(),v(T,{key:d},[r.day?(s(),p(W,{key:0,color:d===m(h)?"orange":"",week:r,onMutate:m(Q)},null,8,["color","week","onMutate"])):b("",!0)],64))),128))]),_:1})):b("",!0)]),_:1}))}};export{ae as default};
