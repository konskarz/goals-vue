import{aJ as b,f as i,r as w}from"./index-10eca467.js";import{d as l}from"./date-b07ed117.js";import{u as k,a as O}from"./GoalStore-61358c45.js";const B=b("TaskStore",()=>{const{data:o,refetch:p,getItem:m,createItem:D,updateItem:h,deleteItem:y}=k("/tasks/"),s=O(),I=i(()=>o.value&&s.data?o.value.map(e=>({...e,goalName:e.goal?s.getItem(e.goal).name:null})):null),t=w({done:!0,recurring:!0,goal:null}),v=i(()=>t.value.goal?s.getBranch(t.value.goal):null);s.$onAction(({name:e,args:a})=>{e==="deleteItem"&&t.value.goal===a[0]&&(t.value.goal=null)});const c=e=>l.subtractFromDate(e,{days:l.getDayOfWeek(e)-1}),g=e=>l.formatDate(e,"YYYY-MM-DD"),S=l.startOfDate(new Date,"day"),d=c(S),T=g(d),n=i(()=>o.value?o.value.filter(e=>!(!e.planned||new Date(e.planned.slice(0,10))<d&&(t.value.done&&e.done||t.value.recurring&&e.group_id)||v.value&&!v.value.includes(e.goal))).sort((e,a)=>Date.parse(e.planned)-Date.parse(a.planned)):null),Y=i(()=>{const e=(a,r,f)=>{for(;r<=f;){const u=g(r);a[u]={day:u,tasks:[]},r=l.addToDate(r,{days:7})}return a};if(n.value&&n.value.length){const a=c(n.value[0].planned.slice(0,10)),r=l.addToDate(c(n.value[n.value.length-1].planned.slice(0,10)),{days:7}),f=e({},a,r);return n.value.forEach(u=>{f[g(c(u.planned.slice(0,10)))].tasks.push(u)}),f}return e({},d,l.addToDate(d,{days:14}))});return{data:o,refetch:p,getItem:m,createItem:D,updateItem:h,deleteItem:y,relative:I,filter:t,currentWeek:T,calendar:Y}});export{B as u};
