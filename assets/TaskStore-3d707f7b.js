import{af as Y,j as s,r as x}from"./index-0105ba6c.js";import{d as r}from"./date-9cd6d73c.js";import{a as F,u as O}from"./GoalStore-99c0b2a1.js";const A=Y("TaskStore",()=>{const{data:l,refetch:v,getItem:D,createItem:h,updateItem:w,deleteItem:y}=F("/tasks/"),d=O(),I=s(()=>l.value&&d.data?l.value.map(e=>({...e,goalName:e.goal?d.getItem(e.goal).name:null})):null),u=x({show:!1,done:!1,recurring:!1,goal:null}),g=s(()=>u.value.goal?d.getBranch(u.value.goal):null);d.$onAction(({name:e,args:t})=>{e==="deleteItem"&&u.value.goal===t[0]&&(u.value.goal=null)});const c=e=>r.subtractFromDate(e,{days:r.getDayOfWeek(e)-1}),i=e=>r.formatDate(e,"YYYY-MM-DD"),p=r.startOfDate(new Date,"day"),f=c(p),S=i(f),o=s(()=>l.value?l.value.filter(e=>!(!e.planned||new Date(e.planned.slice(0,10))<f&&(!u.value.done&&e.done||!u.value.recurring&&e.group_id)||g.value&&!g.value.includes(e.goal))).sort((e,t)=>Date.parse(e.planned)-Date.parse(t.planned)):null),T=s(()=>{const e=(t,a,n)=>{for(;a<=n;)t[i(a)]=[],a=r.addToDate(a,{days:7});return t};if(o.value&&o.value.length){const t=c(o.value[0].planned.slice(0,10)),a=r.addToDate(c(o.value[o.value.length-1].planned.slice(0,10)),{days:7}),n=e({},t,a);return o.value.forEach(m=>{n[i(c(m.planned.slice(0,10)))].push(m)}),n}return e({},f,r.addToDate(f,{days:14}))}),b=s(()=>{if(!l.value)return null;const e=l.value.filter(a=>{if(!a.group_id||!a.planned)return!1;const n=new Date(a.planned.slice(0,10));return!(n>p||n<r.subtractFromDate(p,{months:6}))}).sort((a,n)=>Date.parse(a.planned)-Date.parse(n.planned));if(!e.length)return null;const t=a=>a.done?100:a.target>1?a.performance/a.target*100:0;return e.reduce((a,n)=>({...a,[n.name]:[...a[n.name]||[],{x:"w"+r.formatDate(n.planned.slice(0,10),"w"),y:t(n)}]}),{})});return{data:l,refetch:v,getItem:D,createItem:h,updateItem:w,deleteItem:y,relative:I,filter:u,currentWeek:S,filtered:o,calendar:T,recurring:b}});export{A as u};
