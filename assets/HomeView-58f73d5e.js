import{b as k,a as W,Q as Z}from"./api.client-528a5c50.js";import{c as T,D as Y,E as N,U as G,f,h as m,S as H,g as M,ai as V,d as J,e as O,j as tt,a9 as I,aj as et,ak as at,I as nt,r as x,Z as p,_ as h,al as g,am as it,a2 as _,a3 as d,an as P,ao as rt,a4 as S,ap as st,aq as ot,ar as y,a5 as L,aa as A,as as lt,a6 as $,a8 as Q,a7 as K,at as C}from"./index-cefa593e.js";import{Q as ut}from"./QPage-e1dd6631.js";import{d as b}from"./date-67a1db25.js";import{Q as ct}from"./QList-72667d1e.js";import{a as w,Q as dt}from"./format-26ae4e5d.js";import{Q as q}from"./QItemLabel-ea686458.js";import{_ as ft,u as ht}from"./NumberInput-30a05f6d.js";import{_ as mt}from"./DurationInput-739d5309.js";const _t=T({name:"QTimeline",props:{...Y,color:{type:String,default:"primary"},side:{type:String,default:"right",validator:e=>["left","right"].includes(e)},layout:{type:String,default:"dense",validator:e=>["dense","comfortable","loose"].includes(e)}},setup(e,{slots:u}){const i=M(),n=N(e,i.proxy.$q);G(V,e);const t=f(()=>`q-timeline q-timeline--${e.layout} q-timeline--${e.layout}--${e.side}`+(n.value===!0?" q-timeline--dark":""));return()=>m("ul",{class:t.value},H(u.default))}}),gt=T({name:"QTimelineEntry",props:{heading:Boolean,tag:{type:String,default:"h3"},side:{type:String,default:"right",validator:e=>["left","right"].includes(e)},icon:String,avatar:String,color:String,title:String,subtitle:String,body:String},setup(e,{slots:u}){const i=J(V,O);if(i===O)return console.error("QTimelineEntry needs to be child of QTimeline"),O;const n=f(()=>`q-timeline__entry q-timeline__entry--${e.side}`+(e.icon!==void 0||e.avatar!==void 0?" q-timeline__entry--icon":"")),t=f(()=>`q-timeline__dot text-${e.color||i.color}`),a=f(()=>i.layout==="comfortable"&&i.side==="left");return()=>{const r=tt(u.default,[]);if(e.body!==void 0&&r.unshift(e.body),e.heading===!0){const o=[m("div"),m("div"),m(e.tag,{class:"q-timeline__heading-title"},r)];return m("div",{class:"q-timeline__heading"},a.value===!0?o.reverse():o)}let s;e.icon!==void 0?s=[m(I,{class:"row items-center justify-center",name:e.icon})]:e.avatar!==void 0&&(s=[m("img",{class:"q-timeline__dot-img",src:e.avatar})]);const l=[m("div",{class:"q-timeline__subtitle"},[m("span",{},H(u.subtitle,[e.subtitle]))]),m("div",{class:t.value},s),m("div",{class:"q-timeline__content"},[m("h6",{class:"q-timeline__title"},H(u.title,[e.title]))].concat(r))];return m("li",{class:n.value},a.value===!0?l.reverse():l)}}});var j;(function(e){var u=function(){function n(){this._dropEffect="move",this._effectAllowed="all",this._data={}}return Object.defineProperty(n.prototype,"dropEffect",{get:function(){return this._dropEffect},set:function(t){this._dropEffect=t},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"effectAllowed",{get:function(){return this._effectAllowed},set:function(t){this._effectAllowed=t},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"types",{get:function(){return Object.keys(this._data)},enumerable:!0,configurable:!0}),n.prototype.clearData=function(t){t!=null?delete this._data[t]:this._data=null},n.prototype.getData=function(t){return this._data[t]||""},n.prototype.setData=function(t,a){this._data[t]=a},n.prototype.setDragImage=function(t,a,r){var s=i._instance;s._imgCustom=t,s._imgOffset={x:a,y:r}},n}();e.DataTransfer=u;var i=function(){function n(){if(this._lastClick=0,n._instance)throw"DragDropTouch instance already created.";var t=!1;if(document.addEventListener("test",function(){},{get passive(){return t=!0,!0}}),"ontouchstart"in document){var a=document,r=this._touchstart.bind(this),s=this._touchmove.bind(this),l=this._touchend.bind(this),o=t?{passive:!1,capture:!1}:!1;a.addEventListener("touchstart",r,o),a.addEventListener("touchmove",s,o),a.addEventListener("touchend",l),a.addEventListener("touchcancel",l)}}return n.getInstance=function(){return n._instance},n.prototype._touchstart=function(t){var a=this;if(this._shouldHandle(t)){if(Date.now()-this._lastClick<n._DBLCLICK&&this._dispatchEvent(t,"dblclick",t.target)){t.cancelable&&t.preventDefault(),this._reset();return}this._reset();var r=this._closestDraggable(t.target);r&&!this._dispatchEvent(t,"mousemove",t.target)&&!this._dispatchEvent(t,"mousedown",t.target)&&(this._dragSource=r,this._ptDown=this._getPoint(t),this._lastTouch=t,t.cancelable&&t.preventDefault(),setTimeout(function(){a._dragSource==r&&a._img==null&&a._dispatchEvent(t,"contextmenu",r)&&a._reset()},n._CTXMENU),n._ISPRESSHOLDMODE&&(this._pressHoldInterval=setTimeout(function(){a._isDragEnabled=!0,a._touchmove(t)},n._PRESSHOLDAWAIT)))}},n.prototype._touchmove=function(t){if(this._shouldCancelPressHoldMove(t)){this._reset();return}if(this._shouldHandleMove(t)||this._shouldHandlePressHoldMove(t)){var a=this._getTarget(t);if(this._dispatchEvent(t,"mousemove",a)){this._lastTouch=t,t.cancelable&&t.preventDefault();return}this._dragSource&&!this._img&&this._shouldStartDragging(t)&&(this._dispatchEvent(t,"dragstart",this._dragSource),this._createImage(t),this._dispatchEvent(t,"dragenter",a)),this._img&&(this._lastTouch=t,t.cancelable&&t.preventDefault(),a!=this._lastTarget&&(this._dispatchEvent(this._lastTouch,"dragleave",this._lastTarget),this._dispatchEvent(t,"dragenter",a),this._lastTarget=a),this._moveImage(t),this._isDropZone=this._dispatchEvent(t,"dragover",a))}},n.prototype._touchend=function(t){if(this._shouldHandle(t)){if(this._dispatchEvent(this._lastTouch,"mouseup",t.target)){t.cancelable&&t.preventDefault();return}this._img||(this._dragSource=null,this._dispatchEvent(this._lastTouch,"click",t.target),this._lastClick=Date.now()),this._destroyImage(),this._dragSource&&(t.type.indexOf("cancel")<0&&this._isDropZone&&this._dispatchEvent(this._lastTouch,"drop",this._lastTarget),this._dispatchEvent(this._lastTouch,"dragend",this._dragSource),this._reset())}},n.prototype._shouldHandle=function(t){return t&&!t.defaultPrevented&&t.touches&&t.touches.length<2},n.prototype._shouldHandleMove=function(t){return!n._ISPRESSHOLDMODE&&this._shouldHandle(t)},n.prototype._shouldHandlePressHoldMove=function(t){return n._ISPRESSHOLDMODE&&this._isDragEnabled&&t&&t.touches&&t.touches.length},n.prototype._shouldCancelPressHoldMove=function(t){return n._ISPRESSHOLDMODE&&!this._isDragEnabled&&this._getDelta(t)>n._PRESSHOLDMARGIN},n.prototype._shouldStartDragging=function(t){var a=this._getDelta(t);return a>n._THRESHOLD||n._ISPRESSHOLDMODE&&a>=n._PRESSHOLDTHRESHOLD},n.prototype._reset=function(){this._destroyImage(),this._dragSource=null,this._lastTouch=null,this._lastTarget=null,this._ptDown=null,this._isDragEnabled=!1,this._isDropZone=!1,this._dataTransfer=new u,clearInterval(this._pressHoldInterval)},n.prototype._getPoint=function(t,a){return t&&t.touches&&(t=t.touches[0]),{x:a?t.pageX:t.clientX,y:a?t.pageY:t.clientY}},n.prototype._getDelta=function(t){if(n._ISPRESSHOLDMODE&&!this._ptDown)return 0;var a=this._getPoint(t);return Math.abs(a.x-this._ptDown.x)+Math.abs(a.y-this._ptDown.y)},n.prototype._getTarget=function(t){for(var a=this._getPoint(t),r=document.elementFromPoint(a.x,a.y);r&&getComputedStyle(r).pointerEvents=="none";)r=r.parentElement;return r},n.prototype._createImage=function(t){this._img&&this._destroyImage();var a=this._imgCustom||this._dragSource;if(this._img=a.cloneNode(!0),this._copyStyle(a,this._img),this._img.style.top=this._img.style.left="-9999px",!this._imgCustom){var r=a.getBoundingClientRect(),s=this._getPoint(t);this._imgOffset={x:s.x-r.left,y:s.y-r.top},this._img.style.opacity=n._OPACITY.toString()}this._moveImage(t),document.body.appendChild(this._img)},n.prototype._destroyImage=function(){this._img&&this._img.parentElement&&this._img.parentElement.removeChild(this._img),this._img=null,this._imgCustom=null},n.prototype._moveImage=function(t){var a=this;requestAnimationFrame(function(){if(a._img){var r=a._getPoint(t,!0),s=a._img.style;s.position="absolute",s.pointerEvents="none",s.zIndex="999999",s.left=Math.round(r.x-a._imgOffset.x)+"px",s.top=Math.round(r.y-a._imgOffset.y)+"px"}})},n.prototype._copyProps=function(t,a,r){for(var s=0;s<r.length;s++){var l=r[s];t[l]=a[l]}},n.prototype._copyStyle=function(t,a){if(n._rmvAtts.forEach(function(v){a.removeAttribute(v)}),t instanceof HTMLCanvasElement){var r=t,s=a;s.width=r.width,s.height=r.height,s.getContext("2d").drawImage(r,0,0)}for(var l=getComputedStyle(t),o=0;o<l.length;o++){var c=l[o];c.indexOf("transition")<0&&(a.style[c]=l[c])}a.style.pointerEvents="none";for(var o=0;o<t.children.length;o++)this._copyStyle(t.children[o],a.children[o])},n.prototype._dispatchEvent=function(t,a,r){if(t&&r){var s=document.createEvent("Event"),l=t.touches?t.touches[0]:t;return s.initEvent(a,!0,!0),s.button=0,s.which=s.buttons=1,this._copyProps(s,t,n._kbdProps),this._copyProps(s,l,n._ptProps),s.dataTransfer=this._dataTransfer,r.dispatchEvent(s),s.defaultPrevented}return!1},n.prototype._closestDraggable=function(t){for(;t;t=t.parentElement)if(t.hasAttribute("draggable")&&t.draggable)return t;return null},n}();i._instance=new i,i._THRESHOLD=5,i._OPACITY=.5,i._DBLCLICK=500,i._CTXMENU=900,i._ISPRESSHOLDMODE=!1,i._PRESSHOLDAWAIT=400,i._PRESSHOLDMARGIN=25,i._PRESSHOLDTHRESHOLD=0,i._rmvAtts="id,class,style,draggable".split(","),i._kbdProps="altKey,ctrlKey,metaKey,shiftKey".split(","),i._ptProps="pageX,pageY,clientX,clientY,screenX,screenY".split(","),e.DragDropTouch=i})(j||(j={}));const pt={xs:2,sm:4,md:6,lg:10,xl:14};function B(e,u,i){return{transform:u===!0?`translateX(${i.lang.rtl===!0?"-":""}100%) scale3d(${-e},1,1)`:`scale3d(${e},1,1)`}}const vt=T({name:"QLinearProgress",props:{...Y,...et,value:{type:Number,default:0},buffer:Number,color:String,trackColor:String,reverse:Boolean,stripe:Boolean,indeterminate:Boolean,query:Boolean,rounded:Boolean,animationSpeed:{type:[String,Number],default:2100},instantFeedback:Boolean},setup(e,{slots:u}){const{proxy:i}=M(),n=N(e,i.$q),t=at(e,pt),a=f(()=>e.indeterminate===!0||e.query===!0),r=f(()=>e.reverse!==e.query),s=f(()=>({...t.value!==null?t.value:{},"--q-linear-progress-speed":`${e.animationSpeed}ms`})),l=f(()=>"q-linear-progress"+(e.color!==void 0?` text-${e.color}`:"")+(e.reverse===!0||e.query===!0?" q-linear-progress--reverse":"")+(e.rounded===!0?" rounded-borders":"")),o=f(()=>B(e.buffer!==void 0?e.buffer:1,r.value,i.$q)),c=f(()=>`with${e.instantFeedback===!0?"out":""}-transition`),v=f(()=>`q-linear-progress__track absolute-full q-linear-progress__track--${c.value} q-linear-progress__track--${n.value===!0?"dark":"light"}`+(e.trackColor!==void 0?` bg-${e.trackColor}`:"")),D=f(()=>B(a.value===!0?1:e.value,r.value,i.$q)),F=f(()=>`q-linear-progress__model absolute-full q-linear-progress__model--${c.value} q-linear-progress__model--${a.value===!0?"in":""}determinate`),z=f(()=>({width:`${e.value*100}%`})),U=f(()=>`q-linear-progress__stripe absolute-${e.reverse===!0?"right":"left"} q-linear-progress__stripe--${c.value}`);return()=>{const R=[m("div",{class:v.value,style:o.value}),m("div",{class:F.value,style:D.value})];return e.stripe===!0&&a.value===!1&&R.push(m("div",{class:U.value,style:z.value})),m("div",{class:l.value,style:s.value,role:"progressbar","aria-valuemin":0,"aria-valuemax":1,"aria-valuenow":e.indeterminate===!0?void 0:e.value},nt(u.default,R))}}}),yt=m("div",{class:"q-space"}),Dt=T({name:"QSpace",setup(){return()=>yt}}),St=()=>!0;function bt(e){const u={};return e.forEach(i=>{u[i]=St}),u}function E(){const{emit:e,proxy:u}=M(),i=x(null);function n(){i.value.show()}function t(){i.value.hide()}function a(s){e("ok",s),t()}function r(){e("hide")}return Object.assign(u,{show:n,hide:t}),{dialogRef:i,onDialogHide:r,onDialogOK:a,onDialogCancel:t}}const X=["ok","hide"];E.emits=X;E.emitsObject=bt(X);const kt=ot("div",{class:"text-h6"},"Progress",-1),Et={__name:"ProgressDialog",props:{task:{type:Object,required:!0}},emits:[...E.emits],setup(e){const u=e,i=x(u.task.performance),n=x(null),{dialogRef:t,onDialogHide:a,onDialogOK:r,onDialogCancel:s}=E(),l=f(()=>i.value===u.task.performance&&!n.value);function o(){r({performance:i.value,duration:n.value})}return(c,v)=>(_(),p(it,{ref_key:"dialogRef",ref:t,onHide:g(a)},{default:h(()=>[d(st,{class:"q-dialog-plugin"},{default:h(()=>[d(P,null,{default:h(()=>[kt]),_:1}),d(P,null,{default:h(()=>[d(ft,{modelValue:i.value,"onUpdate:modelValue":v[0]||(v[0]=D=>i.value=D),label:"Performance",hint:"of "+e.task.target},null,8,["modelValue","hint"])]),_:1}),d(P,null,{default:h(()=>[d(mt,{modelValue:n.value,"onUpdate:modelValue":v[1]||(v[1]=D=>n.value=D),label:"Time spent"},null,8,["modelValue"])]),_:1}),d(rt,{align:"right"},{default:h(()=>[d(S,{flat:"",label:"Edit Task",class:"text-primary",to:{name:"task",params:{id:e.task.id}}},null,8,["to"]),d(Dt),d(S,{flat:"",label:"Cancel",class:"text-primary",onClick:g(s)},null,8,["onClick"]),d(S,{disable:g(l),flat:"",label:"Submit",class:"text-primary",onClick:o},null,8,["disable"])]),_:1})]),_:1})]),_:1},8,["onHide"]))}},Tt={__name:"TaskListItem",props:{task:{type:Object,required:!0}},emits:["mutate","ondragstart"],setup(e,{emit:u}){const i=e,n=ht(),t=f(()=>i.task.target>1),a=f(()=>t.value?i.task.performance/i.task.target:0),r=f(()=>[i.task.performance,"of",i.task.target].join(" "));function s(){n.dialog({component:Et,componentProps:{task:i.task}}).onOk(l=>{l.performance!==i.task.performance&&k.update("/tasks/"+i.task.id+"/",{performance:l.performance}).then(()=>u("mutate")),l.duration&&k.create("/times/",{task:i.task.id,start:new Date().toISOString(),end:null,duration:l.duration,description:""}).then(()=>u("mutate"))})}return(l,o)=>(_(),p(dt,{clickable:"",class:lt(e.task.done?"text-grey":"")},{default:h(()=>[d(w,{thumbnail:"",style:{cursor:"grab"},draggable:"true",onDragstart:o[0]||(o[0]=c=>l.$emit("ondragstart",c,e.task)),"onTouchmove:native":o[1]||(o[1]=c=>{})},{default:h(()=>[d(I,{name:"drag_indicator"})]),_:1}),e.task.group_id?(_(),p(w,{key:0,thumbnail:""},{default:h(()=>[d(I,{name:"event_repeat"})]),_:1})):y("",!0),d(w,{onClick:s},{default:h(()=>[d(q,null,{default:h(()=>[L(A(e.task.name),1)]),_:1}),g(t)?(_(),p(q,{key:0,caption:""},{default:h(()=>[L(A(g(r)),1)]),_:1})):y("",!0),g(t)?(_(),p(q,{key:1},{default:h(()=>[d(vt,{value:g(a)},null,8,["value"])]),_:1})):y("",!0)]),_:1})]),_:1},8,["class"]))}},Ot={__name:"WeekTimelineEntry",props:{week:{type:Object,required:!0}},emits:["mutate"],setup(e,{emit:u}){const i=e,n=new Date(i.week.day),t=b.formatDate(n,"w-YYYY-Q-MMM D").split("-"),a=["Week "+t[0],t[1]+" / Q"+t[2],t[3]].join(" · ");function r(l,o){const c={id:o.id,day:b.getDayOfWeek(o.planned),week:t[0]};l.dataTransfer.setData("text",JSON.stringify(c)),l.dataTransfer.dropEffect="move"}function s(l){const o=JSON.parse(l.dataTransfer.getData("text"));if(o.week===t[0])return;const c=b.addToDate(n,{days:o.day-1});k.update("/tasks/"+o.id+"/",{planned:c.toISOString()}).then(()=>u("mutate"))}return(l,o)=>(_(),p(gt,{subtitle:g(a),onDragover:o[1]||(o[1]=C(()=>{},["prevent"])),onDragenter:o[2]||(o[2]=C(()=>{},["prevent"])),onDrop:o[3]||(o[3]=C(c=>s(c),["prevent"]))},{default:h(()=>[e.week.tasks&&e.week.tasks.length?(_(),p(ct,{key:0},{default:h(()=>[(_(!0),$(Q,null,K(e.week.tasks,c=>(_(),p(Tt,{key:c.id,task:c,onOndragstart:r,onMutate:o[0]||(o[0]=v=>l.$emit("mutate"))},null,8,["task"]))),128))]),_:1})):y("",!0)]),_:1},8,["subtitle"]))}},Qt={__name:"HomeView",setup(e){const u=b.formatDate(new Date,"YYYY-w"),{data:i,mutate:n}=k.read("/plan/");return(t,a)=>(_(),p(ut,{padding:""},{default:h(()=>[d(Z,null,{default:h(()=>[d(W,null,{default:h(()=>[L("Plan")]),_:1}),d(S,{to:{name:"task",params:{id:"create"}},icon:"assignment_add",flat:"",round:""})]),_:1}),g(i)?(_(),p(_t,{key:0,layout:"dense",class:"q-px-md"},{default:h(()=>[(_(!0),$(Q,null,K(g(i),(r,s)=>(_(),$(Q,{key:s},[r.day?(_(),p(Ot,{key:0,color:s===g(u)?"orange":"",week:r,onMutate:g(n)},null,8,["color","week","onMutate"])):y("",!0)],64))),128))]),_:1})):y("",!0)]),_:1}))}};export{Qt as default};
