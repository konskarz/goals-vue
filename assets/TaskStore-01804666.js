import{aF as b,d as i,r as w}from"./index-387a8200.js";import{d as l}from"./date-08927ab6.js";import{a as F,u as O}from"./GoalStore-d1c1993f.js";const B=b("TaskStore",()=>{const{data:o,refetch:p,getItem:m,createItem:D,updateItem:h,deleteItem:y}=F("/tasks/"),u=O(),I=i(()=>o.value&&u.data?o.value.map(e=>({...e,goalName:e.goal?u.getItem(e.goal).name:null})):null),t=w({done:!0,recurring:!0,goal:null}),g=i(()=>t.value.goal?u.getBranch(t.value.goal):null);u.$onAction(({name:e,args:a})=>{e==="deleteItem"&&t.value.goal===a[0]&&(t.value.goal=null)});const s=e=>l.subtractFromDate(e,{days:l.getDayOfWeek(e)-1}),f=e=>l.formatDate(e,"YYYY-MM-DD"),S=l.startOfDate(new Date,"day"),d=s(S),T=f(d),n=i(()=>o.value?o.value.filter(e=>!(!e.planned||new Date(e.planned.slice(0,10))<d&&(t.value.done&&e.done||t.value.recurring&&e.group_id)||g.value&&!g.value.includes(e.goal))).sort((e,a)=>Date.parse(e.planned)-Date.parse(a.planned)):null),Y=i(()=>{const e=(a,r,c)=>{for(;r<=c;)a[f(r)]=[],r=l.addToDate(r,{days:7});return a};if(n.value&&n.value.length){const a=s(n.value[0].planned.slice(0,10)),r=l.addToDate(s(n.value[n.value.length-1].planned.slice(0,10)),{days:7}),c=e({},a,r);return n.value.forEach(v=>{c[f(s(v.planned.slice(0,10)))].push(v)}),c}return e({},d,l.addToDate(d,{days:14}))});return{data:o,refetch:p,getItem:m,createItem:D,updateItem:h,deleteItem:y,relative:I,filter:t,currentWeek:T,calendar:Y}});export{B as u};
