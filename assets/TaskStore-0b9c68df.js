import{aQ as b,f as i,r as w}from"./index-2d7f9719.js";import{d as r}from"./date-d35286ec.js";import{a as k,u as O}from"./GoalStore-0f50ca45.js";const B=b("TaskStore",()=>{const{data:o,refetch:m,getItem:D,createItem:p,updateItem:h,deleteItem:y}=k("/tasks/"),u=O(),I=i(()=>o.value&&u.data?o.value.map(e=>({...e,goalName:e.goal?u.getItem(e.goal).name:null})):null),a=w({done:!0,recurring:!0,goal:null}),v=i(()=>a.value.goal?u.getBranch(a.value.goal):null);u.$onAction(({name:e,args:t})=>{e==="deleteItem"&&a.value.goal===t[0]&&(a.value.goal=null)});const c=e=>r.subtractFromDate(e,{days:r.getDayOfWeek(e)-1}),g=e=>r.formatDate(e,"YYYY-MM-DD"),S=r.startOfDate(new Date,"day"),d=c(S),T=g(d),l=i(()=>o.value?o.value.filter(e=>!(!e.starts||new Date(e.starts.slice(0,10))<d&&(a.value.done&&e.done||a.value.recurring&&e.group_id)||v.value&&!v.value.includes(e.goal))).sort((e,t)=>Date.parse(e.starts)-Date.parse(t.starts)):null),Y=i(()=>{const e=(t,s,f)=>{for(;s<=f;){const n=g(s);t[n]={day:n,tasks:[]},s=r.addToDate(s,{days:7})}return t};if(l.value&&l.value.length){const t=c(l.value[0].starts.slice(0,10)),s=r.addToDate(c(l.value[l.value.length-1].starts.slice(0,10)),{days:7}),f=e({},t,s);return l.value.forEach(n=>{f[g(c(n.starts.slice(0,10)))].tasks.push(n)}),f}return e({},d,r.addToDate(d,{days:14}))});return{data:o,refetch:m,getItem:D,createItem:p,updateItem:h,deleteItem:y,relative:I,filter:a,currentWeek:T,calendar:Y}});export{B as u};
