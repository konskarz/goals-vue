import{af as x,j as d,r as F}from"./index-e65528cc.js";import{d as l}from"./date-4e6d5ac7.js";import{a as O,u as W}from"./GoalStore-3694516c.js";const B=x("TaskStore",()=>{const{data:u,refetch:D,getItem:h,createItem:y,updateItem:w,deleteItem:I}=O("/tasks/"),i=W(),S=d(()=>u.value&&i.data?u.value.map(e=>({...e,goalName:e.goal?i.getItem(e.goal).name:null})):null),o=F({done:!0,recurring:!0,goal:null}),v=d(()=>o.value.goal?i.getBranch(o.value.goal):null);i.$onAction(({name:e,args:a})=>{e==="deleteItem"&&o.value.goal===a[0]&&(o.value.goal=null)});const f=e=>l.subtractFromDate(e,{days:l.getDayOfWeek(e)-1}),g=e=>l.formatDate(e,"YYYY-MM-DD"),m=l.startOfDate(new Date,"day"),p=f(m),T=g(p),s=d(()=>u.value?u.value.filter(e=>!(!e.planned||new Date(e.planned.slice(0,10))<p&&(o.value.done&&e.done||o.value.recurring&&e.group_id)||v.value&&!v.value.includes(e.goal))).sort((e,a)=>Date.parse(e.planned)-Date.parse(a.planned)):null),b=d(()=>{const e=(a,t,c)=>{for(;t<=c;)a[g(t)]=[],t=l.addToDate(t,{days:7});return a};if(s.value&&s.value.length){const a=f(s.value[0].planned.slice(0,10)),t=l.addToDate(f(s.value[s.value.length-1].planned.slice(0,10)),{days:7}),c=e({},a,t);return s.value.forEach(n=>{c[g(f(n.planned.slice(0,10)))].push(n)}),c}return e({},p,l.addToDate(p,{days:14}))}),Y=d(()=>{if(!u.value)return null;const e=u.value.filter(n=>{if(!n.group_id||!n.planned)return!1;const r=new Date(n.planned.slice(0,10));return!(r>m||r<l.subtractFromDate(m,{months:6}))}).sort((n,r)=>Date.parse(n.planned)-Date.parse(r.planned));if(!e.length)return null;const a=n=>n.done?100:n.target>1?n.performance/n.target*100:0,t=e.reduce((n,r)=>({...n,[r.name]:[...n[r.name]||[],{x:"w"+l.formatDate(r.planned.slice(0,10),"w"),y:a(r)}]}),{}),c=[];for(const n in t)c.push({name:n,data:t[n]});return c});return{data:u,refetch:D,getItem:h,createItem:y,updateItem:w,deleteItem:I,relative:S,filter:o,currentWeek:T,filtered:s,calendar:b,recurring:Y}});export{B as u};
