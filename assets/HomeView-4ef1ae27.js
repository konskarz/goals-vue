import{b as E,a as G,Q as W}from"./api.client-bd7e8505.js";import{c as P,D as N,E as V,U as Z,f as d,h,S as x,g as R,ai as K,d as J,e as w,j as tt,a9 as L,aj as et,ak as at,I as nt,r as T,Z as v,_ as m,al as g,am as it,a2 as _,a3 as f,an as C,ao as rt,a4 as k,ap as st,aq as ot,ar as S,a5 as $,aa as A,as as lt,a6 as M,a8 as Q,a7 as F,at as I,o as ut,w as ct}from"./index-940e76f3.js";import{Q as dt}from"./QPage-299b6608.js";import{d as b}from"./date-1be0916d.js";import{_ as ft}from"./GoalSelect-721c97c8.js";import{Q as mt}from"./QList-ab92c950.js";import{a as q,Q as ht}from"./format-dbce8ede.js";import{Q as H}from"./QItemLabel-799f1649.js";import{_ as _t,u as gt}from"./NumberInput-3e118e28.js";import{_ as pt}from"./DurationInput-36f291c8.js";import"./selection-c9e54b9f.js";const vt=P({name:"QTimeline",props:{...N,color:{type:String,default:"primary"},side:{type:String,default:"right",validator:e=>["left","right"].includes(e)},layout:{type:String,default:"dense",validator:e=>["dense","comfortable","loose"].includes(e)}},setup(e,{slots:u}){const i=R(),a=V(e,i.proxy.$q);Z(K,e);const t=d(()=>`q-timeline q-timeline--${e.layout} q-timeline--${e.layout}--${e.side}`+(a.value===!0?" q-timeline--dark":""));return()=>h("ul",{class:t.value},x(u.default))}}),yt=P({name:"QTimelineEntry",props:{heading:Boolean,tag:{type:String,default:"h3"},side:{type:String,default:"right",validator:e=>["left","right"].includes(e)},icon:String,avatar:String,color:String,title:String,subtitle:String,body:String},setup(e,{slots:u}){const i=J(K,w);if(i===w)return console.error("QTimelineEntry needs to be child of QTimeline"),w;const a=d(()=>`q-timeline__entry q-timeline__entry--${e.side}`+(e.icon!==void 0||e.avatar!==void 0?" q-timeline__entry--icon":"")),t=d(()=>`q-timeline__dot text-${e.color||i.color}`),n=d(()=>i.layout==="comfortable"&&i.side==="left");return()=>{const s=tt(u.default,[]);if(e.body!==void 0&&s.unshift(e.body),e.heading===!0){const o=[h("div"),h("div"),h(e.tag,{class:"q-timeline__heading-title"},s)];return h("div",{class:"q-timeline__heading"},n.value===!0?o.reverse():o)}let r;e.icon!==void 0?r=[h(L,{class:"row items-center justify-center",name:e.icon})]:e.avatar!==void 0&&(r=[h("img",{class:"q-timeline__dot-img",src:e.avatar})]);const l=[h("div",{class:"q-timeline__subtitle"},[h("span",{},x(u.subtitle,[e.subtitle]))]),h("div",{class:t.value},r),h("div",{class:"q-timeline__content"},[h("h6",{class:"q-timeline__title"},x(u.title,[e.title]))].concat(s))];return h("li",{class:a.value},n.value===!0?l.reverse():l)}}});var j;(function(e){var u=function(){function a(){this._dropEffect="move",this._effectAllowed="all",this._data={}}return Object.defineProperty(a.prototype,"dropEffect",{get:function(){return this._dropEffect},set:function(t){this._dropEffect=t},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"effectAllowed",{get:function(){return this._effectAllowed},set:function(t){this._effectAllowed=t},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"types",{get:function(){return Object.keys(this._data)},enumerable:!0,configurable:!0}),a.prototype.clearData=function(t){t!=null?delete this._data[t]:this._data=null},a.prototype.getData=function(t){return this._data[t]||""},a.prototype.setData=function(t,n){this._data[t]=n},a.prototype.setDragImage=function(t,n,s){var r=i._instance;r._imgCustom=t,r._imgOffset={x:n,y:s}},a}();e.DataTransfer=u;var i=function(){function a(){if(this._lastClick=0,a._instance)throw"DragDropTouch instance already created.";var t=!1;if(document.addEventListener("test",function(){},{get passive(){return t=!0,!0}}),"ontouchstart"in document){var n=document,s=this._touchstart.bind(this),r=this._touchmove.bind(this),l=this._touchend.bind(this),o=t?{passive:!1,capture:!1}:!1;n.addEventListener("touchstart",s,o),n.addEventListener("touchmove",r,o),n.addEventListener("touchend",l),n.addEventListener("touchcancel",l)}}return a.getInstance=function(){return a._instance},a.prototype._touchstart=function(t){var n=this;if(this._shouldHandle(t)){if(Date.now()-this._lastClick<a._DBLCLICK&&this._dispatchEvent(t,"dblclick",t.target)){t.cancelable&&t.preventDefault(),this._reset();return}this._reset();var s=this._closestDraggable(t.target);s&&!this._dispatchEvent(t,"mousemove",t.target)&&!this._dispatchEvent(t,"mousedown",t.target)&&(this._dragSource=s,this._ptDown=this._getPoint(t),this._lastTouch=t,t.cancelable&&t.preventDefault(),setTimeout(function(){n._dragSource==s&&n._img==null&&n._dispatchEvent(t,"contextmenu",s)&&n._reset()},a._CTXMENU),a._ISPRESSHOLDMODE&&(this._pressHoldInterval=setTimeout(function(){n._isDragEnabled=!0,n._touchmove(t)},a._PRESSHOLDAWAIT)))}},a.prototype._touchmove=function(t){if(this._shouldCancelPressHoldMove(t)){this._reset();return}if(this._shouldHandleMove(t)||this._shouldHandlePressHoldMove(t)){var n=this._getTarget(t);if(this._dispatchEvent(t,"mousemove",n)){this._lastTouch=t,t.cancelable&&t.preventDefault();return}this._dragSource&&!this._img&&this._shouldStartDragging(t)&&(this._dispatchEvent(t,"dragstart",this._dragSource),this._createImage(t),this._dispatchEvent(t,"dragenter",n)),this._img&&(this._lastTouch=t,t.cancelable&&t.preventDefault(),n!=this._lastTarget&&(this._dispatchEvent(this._lastTouch,"dragleave",this._lastTarget),this._dispatchEvent(t,"dragenter",n),this._lastTarget=n),this._moveImage(t),this._isDropZone=this._dispatchEvent(t,"dragover",n))}},a.prototype._touchend=function(t){if(this._shouldHandle(t)){if(this._dispatchEvent(this._lastTouch,"mouseup",t.target)){t.cancelable&&t.preventDefault();return}this._img||(this._dragSource=null,this._dispatchEvent(this._lastTouch,"click",t.target),this._lastClick=Date.now()),this._destroyImage(),this._dragSource&&(t.type.indexOf("cancel")<0&&this._isDropZone&&this._dispatchEvent(this._lastTouch,"drop",this._lastTarget),this._dispatchEvent(this._lastTouch,"dragend",this._dragSource),this._reset())}},a.prototype._shouldHandle=function(t){return t&&!t.defaultPrevented&&t.touches&&t.touches.length<2},a.prototype._shouldHandleMove=function(t){return!a._ISPRESSHOLDMODE&&this._shouldHandle(t)},a.prototype._shouldHandlePressHoldMove=function(t){return a._ISPRESSHOLDMODE&&this._isDragEnabled&&t&&t.touches&&t.touches.length},a.prototype._shouldCancelPressHoldMove=function(t){return a._ISPRESSHOLDMODE&&!this._isDragEnabled&&this._getDelta(t)>a._PRESSHOLDMARGIN},a.prototype._shouldStartDragging=function(t){var n=this._getDelta(t);return n>a._THRESHOLD||a._ISPRESSHOLDMODE&&n>=a._PRESSHOLDTHRESHOLD},a.prototype._reset=function(){this._destroyImage(),this._dragSource=null,this._lastTouch=null,this._lastTarget=null,this._ptDown=null,this._isDragEnabled=!1,this._isDropZone=!1,this._dataTransfer=new u,clearInterval(this._pressHoldInterval)},a.prototype._getPoint=function(t,n){return t&&t.touches&&(t=t.touches[0]),{x:n?t.pageX:t.clientX,y:n?t.pageY:t.clientY}},a.prototype._getDelta=function(t){if(a._ISPRESSHOLDMODE&&!this._ptDown)return 0;var n=this._getPoint(t);return Math.abs(n.x-this._ptDown.x)+Math.abs(n.y-this._ptDown.y)},a.prototype._getTarget=function(t){for(var n=this._getPoint(t),s=document.elementFromPoint(n.x,n.y);s&&getComputedStyle(s).pointerEvents=="none";)s=s.parentElement;return s},a.prototype._createImage=function(t){this._img&&this._destroyImage();var n=this._imgCustom||this._dragSource;if(this._img=n.cloneNode(!0),this._copyStyle(n,this._img),this._img.style.top=this._img.style.left="-9999px",!this._imgCustom){var s=n.getBoundingClientRect(),r=this._getPoint(t);this._imgOffset={x:r.x-s.left,y:r.y-s.top},this._img.style.opacity=a._OPACITY.toString()}this._moveImage(t),document.body.appendChild(this._img)},a.prototype._destroyImage=function(){this._img&&this._img.parentElement&&this._img.parentElement.removeChild(this._img),this._img=null,this._imgCustom=null},a.prototype._moveImage=function(t){var n=this;requestAnimationFrame(function(){if(n._img){var s=n._getPoint(t,!0),r=n._img.style;r.position="absolute",r.pointerEvents="none",r.zIndex="999999",r.left=Math.round(s.x-n._imgOffset.x)+"px",r.top=Math.round(s.y-n._imgOffset.y)+"px"}})},a.prototype._copyProps=function(t,n,s){for(var r=0;r<s.length;r++){var l=s[r];t[l]=n[l]}},a.prototype._copyStyle=function(t,n){if(a._rmvAtts.forEach(function(y){n.removeAttribute(y)}),t instanceof HTMLCanvasElement){var s=t,r=n;r.width=s.width,r.height=s.height,r.getContext("2d").drawImage(s,0,0)}for(var l=getComputedStyle(t),o=0;o<l.length;o++){var c=l[o];c.indexOf("transition")<0&&(n.style[c]=l[c])}n.style.pointerEvents="none";for(var o=0;o<t.children.length;o++)this._copyStyle(t.children[o],n.children[o])},a.prototype._dispatchEvent=function(t,n,s){if(t&&s){var r=document.createEvent("Event"),l=t.touches?t.touches[0]:t;return r.initEvent(n,!0,!0),r.button=0,r.which=r.buttons=1,this._copyProps(r,t,a._kbdProps),this._copyProps(r,l,a._ptProps),r.dataTransfer=this._dataTransfer,s.dispatchEvent(r),r.defaultPrevented}return!1},a.prototype._closestDraggable=function(t){for(;t;t=t.parentElement)if(t.hasAttribute("draggable")&&t.draggable)return t;return null},a}();i._instance=new i,i._THRESHOLD=5,i._OPACITY=.5,i._DBLCLICK=500,i._CTXMENU=900,i._ISPRESSHOLDMODE=!1,i._PRESSHOLDAWAIT=400,i._PRESSHOLDMARGIN=25,i._PRESSHOLDTHRESHOLD=0,i._rmvAtts="id,class,style,draggable".split(","),i._kbdProps="altKey,ctrlKey,metaKey,shiftKey".split(","),i._ptProps="pageX,pageY,clientX,clientY,screenX,screenY".split(","),e.DragDropTouch=i})(j||(j={}));const Dt={xs:2,sm:4,md:6,lg:10,xl:14};function B(e,u,i){return{transform:u===!0?`translateX(${i.lang.rtl===!0?"-":""}100%) scale3d(${-e},1,1)`:`scale3d(${e},1,1)`}}const St=P({name:"QLinearProgress",props:{...N,...et,value:{type:Number,default:0},buffer:Number,color:String,trackColor:String,reverse:Boolean,stripe:Boolean,indeterminate:Boolean,query:Boolean,rounded:Boolean,animationSpeed:{type:[String,Number],default:2100},instantFeedback:Boolean},setup(e,{slots:u}){const{proxy:i}=R(),a=V(e,i.$q),t=at(e,Dt),n=d(()=>e.indeterminate===!0||e.query===!0),s=d(()=>e.reverse!==e.query),r=d(()=>({...t.value!==null?t.value:{},"--q-linear-progress-speed":`${e.animationSpeed}ms`})),l=d(()=>"q-linear-progress"+(e.color!==void 0?` text-${e.color}`:"")+(e.reverse===!0||e.query===!0?" q-linear-progress--reverse":"")+(e.rounded===!0?" rounded-borders":"")),o=d(()=>B(e.buffer!==void 0?e.buffer:1,s.value,i.$q)),c=d(()=>`with${e.instantFeedback===!0?"out":""}-transition`),y=d(()=>`q-linear-progress__track absolute-full q-linear-progress__track--${c.value} q-linear-progress__track--${a.value===!0?"dark":"light"}`+(e.trackColor!==void 0?` bg-${e.trackColor}`:"")),p=d(()=>B(n.value===!0?1:e.value,s.value,i.$q)),D=d(()=>`q-linear-progress__model absolute-full q-linear-progress__model--${c.value} q-linear-progress__model--${n.value===!0?"in":""}determinate`),U=d(()=>({width:`${e.value*100}%`})),z=d(()=>`q-linear-progress__stripe absolute-${e.reverse===!0?"right":"left"} q-linear-progress__stripe--${c.value}`);return()=>{const Y=[h("div",{class:y.value,style:o.value}),h("div",{class:D.value,style:p.value})];return e.stripe===!0&&n.value===!1&&Y.push(h("div",{class:z.value,style:U.value})),h("div",{class:l.value,style:r.value,role:"progressbar","aria-valuemin":0,"aria-valuemax":1,"aria-valuenow":e.indeterminate===!0?void 0:e.value},nt(u.default,Y))}}}),bt=h("div",{class:"q-space"}),kt=P({name:"QSpace",setup(){return()=>bt}}),Et=()=>!0;function Tt(e){const u={};return e.forEach(i=>{u[i]=Et}),u}function O(){const{emit:e,proxy:u}=R(),i=T(null);function a(){i.value.show()}function t(){i.value.hide()}function n(r){e("ok",r),t()}function s(){e("hide")}return Object.assign(u,{show:a,hide:t}),{dialogRef:i,onDialogHide:s,onDialogOK:n,onDialogCancel:t}}const X=["ok","hide"];O.emits=X;O.emitsObject=Tt(X);const Ot=ot("div",{class:"text-h6"},"Progress",-1),Pt={__name:"ProgressDialog",props:{task:{type:Object,required:!0}},emits:[...O.emits],setup(e){const u=e,i=T(u.task.performance),a=T(null),t=d(()=>{let y="of "+u.task.target;const p=u.task.performance_history;if(p&&p.length){const D=p[p.length-1];y+=" last updated "+b.formatDate(D.updated,"DD.MM.YYYY HH:mm")}return y}),{dialogRef:n,onDialogHide:s,onDialogOK:r,onDialogCancel:l}=O(),o=d(()=>i.value===u.task.performance&&!a.value);function c(){r({performance:i.value,duration:a.value})}return(y,p)=>(_(),v(it,{ref_key:"dialogRef",ref:n,onHide:g(s)},{default:m(()=>[f(st,{class:"q-dialog-plugin"},{default:m(()=>[f(C,null,{default:m(()=>[Ot]),_:1}),f(C,null,{default:m(()=>[f(_t,{modelValue:i.value,"onUpdate:modelValue":p[0]||(p[0]=D=>i.value=D),label:"Performance",hint:g(t)},null,8,["modelValue","hint"])]),_:1}),f(C,null,{default:m(()=>[f(pt,{modelValue:a.value,"onUpdate:modelValue":p[1]||(p[1]=D=>a.value=D),label:"Time spent"},null,8,["modelValue"])]),_:1}),f(rt,{align:"right"},{default:m(()=>[f(k,{flat:"",label:"Edit Task",class:"text-primary",to:{name:"task",params:{id:e.task.id}}},null,8,["to"]),f(kt),f(k,{flat:"",label:"Cancel",class:"text-primary",onClick:g(l)},null,8,["onClick"]),f(k,{disable:g(o),flat:"",label:"Submit",class:"text-primary",onClick:c},null,8,["disable"])]),_:1})]),_:1})]),_:1},8,["onHide"]))}},wt={__name:"TaskListItem",props:{task:{type:Object,required:!0}},emits:["mutate","ondragstart"],setup(e,{emit:u}){const i=e,a=gt(),t=d(()=>i.task.target>1),n=d(()=>t.value?i.task.performance/i.task.target:0),s=d(()=>[i.task.performance,"of",i.task.target].join(" "));function r(){a.dialog({component:Pt,componentProps:{task:i.task}}).onOk(l=>{l.performance!==i.task.performance&&E.update("/tasks/"+i.task.id+"/",{performance:l.performance}).then(()=>u("mutate")),l.duration&&E.create("/times/",{task:i.task.id,start:new Date().toISOString(),end:null,duration:l.duration,description:""}).then(()=>u("mutate"))})}return(l,o)=>(_(),v(ht,{clickable:"",class:lt(e.task.done?"text-grey":"")},{default:m(()=>[f(q,{thumbnail:"",style:{cursor:"grab"},draggable:"true",onDragstart:o[0]||(o[0]=c=>l.$emit("ondragstart",c,e.task)),"onTouchmove:native":o[1]||(o[1]=c=>{})},{default:m(()=>[f(L,{name:"drag_indicator"})]),_:1}),e.task.group_id?(_(),v(q,{key:0,thumbnail:""},{default:m(()=>[f(L,{name:"event_repeat"})]),_:1})):S("",!0),f(q,{onClick:r},{default:m(()=>[f(H,null,{default:m(()=>[$(A(e.task.name),1)]),_:1}),g(t)?(_(),v(H,{key:0,caption:""},{default:m(()=>[$(A(g(s)),1)]),_:1})):S("",!0),g(t)?(_(),v(H,{key:1},{default:m(()=>[f(St,{value:g(n),color:"positive"},null,8,["value"])]),_:1})):S("",!0)]),_:1})]),_:1},8,["class"]))}},Ct={__name:"WeekTimelineEntry",props:{week:{type:Object,required:!0}},emits:["mutate"],setup(e,{emit:u}){const i=e,a=new Date(i.week.day),t=b.formatDate(a,"w-YYYY-Q-MMM D").split("-"),n=["Week "+t[0],t[1]+" / Q"+t[2],t[3]].join(" Â· ");function s(l,o){const c={id:o.id,day:b.getDayOfWeek(o.planned),week:t[0]};l.dataTransfer.setData("text",JSON.stringify(c)),l.dataTransfer.dropEffect="move"}function r(l){const o=JSON.parse(l.dataTransfer.getData("text"));if(o.week===t[0])return;const c=b.addToDate(a,{days:o.day-1});E.update("/tasks/"+o.id+"/",{planned:c.toISOString()}).then(()=>u("mutate"))}return(l,o)=>(_(),v(yt,{subtitle:g(n),onDragover:o[1]||(o[1]=I(()=>{},["prevent"])),onDragenter:o[2]||(o[2]=I(()=>{},["prevent"])),onDrop:o[3]||(o[3]=I(c=>r(c),["prevent"]))},{default:m(()=>[e.week.tasks&&e.week.tasks.length?(_(),v(mt,{key:0},{default:m(()=>[(_(!0),M(Q,null,F(e.week.tasks,c=>(_(),v(wt,{key:c.id,task:c,onOndragstart:s,onMutate:o[0]||(o[0]=y=>l.$emit("mutate"))},null,8,["task"]))),128))]),_:1})):S("",!0)]),_:1},8,["subtitle"]))}},jt={__name:"HomeView",setup(e){const u="Goal-Filter",i=b.formatDate(new Date,"YYYY-w"),a=T(null),t=d(()=>a.value?"/plan/?goal="+a.value:"/plan/"),{data:n,mutate:s}=E.read(t);return ut(()=>{const r=localStorage.getItem(u);r&&(a.value=parseInt(r))}),ct(a,r=>{r?localStorage.setItem(u,r):localStorage.removeItem(u)}),(r,l)=>(_(),v(dt,{padding:""},{default:m(()=>[f(W,null,{default:m(()=>[f(G,null,{default:m(()=>[$("Plan")]),_:1}),f(ft,{modelValue:a.value,"onUpdate:modelValue":l[0]||(l[0]=o=>a.value=o),label:"For Goal",dense:"",borderless:"",class:"col-6 col-sm-3 col-lg-2"},null,8,["modelValue"]),f(k,{to:{name:"task",params:{id:"create"}},icon:"assignment_add",flat:"",round:""})]),_:1}),g(n)?(_(),v(vt,{key:0,layout:"dense",class:"q-px-md"},{default:m(()=>[(_(!0),M(Q,null,F(g(n),(o,c)=>(_(),M(Q,{key:c},[o.day?(_(),v(Ct,{key:0,color:c===g(i)?"orange":"",week:o,onMutate:g(s)},null,8,["color","week","onMutate"])):S("",!0)],64))),128))]),_:1})):S("",!0)]),_:1}))}};export{jt as default};
