import{b as S,a as V,Q as K}from"./api.client-a4d8c645.js";import{c as Q,D as B,E as X,U,f as v,h as f,S as w,g as j,ai as $,d as F,e as T,j as W,a9 as H,r as I,Z as g,_ as d,aj as m,ak as Z,a2 as _,a3 as c,al as O,am as G,a4 as y,an as J,ao as z,ap as E,a5 as x,aa as q,a6 as L,a8 as M,a7 as Y,aq as P}from"./index-d95bd3d0.js";import{Q as tt}from"./QPage-3d0952cc.js";import{d as D}from"./date-d3e0eda7.js";import{Q as et}from"./QList-cfed8deb.js";import{a as C,Q as at}from"./format-d2ace315.js";import{Q as R}from"./QItemLabel-ce593f33.js";import{_ as nt,u as it}from"./NumberInput-709d0027.js";import{_ as st}from"./DurationInput-0b9dd6de.js";const ot=Q({name:"QTimeline",props:{...B,color:{type:String,default:"primary"},side:{type:String,default:"right",validator:i=>["left","right"].includes(i)},layout:{type:String,default:"dense",validator:i=>["dense","comfortable","loose"].includes(i)}},setup(i,{slots:u}){const o=j(),e=X(i,o.proxy.$q);U($,i);const t=v(()=>`q-timeline q-timeline--${i.layout} q-timeline--${i.layout}--${i.side}`+(e.value===!0?" q-timeline--dark":""));return()=>f("ul",{class:t.value},w(u.default))}}),rt=Q({name:"QTimelineEntry",props:{heading:Boolean,tag:{type:String,default:"h3"},side:{type:String,default:"right",validator:i=>["left","right"].includes(i)},icon:String,avatar:String,color:String,title:String,subtitle:String,body:String},setup(i,{slots:u}){const o=F($,T);if(o===T)return console.error("QTimelineEntry needs to be child of QTimeline"),T;const e=v(()=>`q-timeline__entry q-timeline__entry--${i.side}`+(i.icon!==void 0||i.avatar!==void 0?" q-timeline__entry--icon":"")),t=v(()=>`q-timeline__dot text-${i.color||o.color}`),a=v(()=>o.layout==="comfortable"&&o.side==="left");return()=>{const n=W(u.default,[]);if(i.body!==void 0&&n.unshift(i.body),i.heading===!0){const r=[f("div"),f("div"),f(i.tag,{class:"q-timeline__heading-title"},n)];return f("div",{class:"q-timeline__heading"},a.value===!0?r.reverse():r)}let s;i.icon!==void 0?s=[f(H,{class:"row items-center justify-center",name:i.icon})]:i.avatar!==void 0&&(s=[f("img",{class:"q-timeline__dot-img",src:i.avatar})]);const l=[f("div",{class:"q-timeline__subtitle"},[f("span",{},w(u.subtitle,[i.subtitle]))]),f("div",{class:t.value},s),f("div",{class:"q-timeline__content"},[f("h6",{class:"q-timeline__title"},w(u.title,[i.title]))].concat(n))];return f("li",{class:e.value},a.value===!0?l.reverse():l)}}});var A;(function(i){var u=function(){function e(){this._dropEffect="move",this._effectAllowed="all",this._data={}}return Object.defineProperty(e.prototype,"dropEffect",{get:function(){return this._dropEffect},set:function(t){this._dropEffect=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"effectAllowed",{get:function(){return this._effectAllowed},set:function(t){this._effectAllowed=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"types",{get:function(){return Object.keys(this._data)},enumerable:!0,configurable:!0}),e.prototype.clearData=function(t){t!=null?delete this._data[t]:this._data=null},e.prototype.getData=function(t){return this._data[t]||""},e.prototype.setData=function(t,a){this._data[t]=a},e.prototype.setDragImage=function(t,a,n){var s=o._instance;s._imgCustom=t,s._imgOffset={x:a,y:n}},e}();i.DataTransfer=u;var o=function(){function e(){if(this._lastClick=0,e._instance)throw"DragDropTouch instance already created.";var t=!1;if(document.addEventListener("test",function(){},{get passive(){return t=!0,!0}}),"ontouchstart"in document){var a=document,n=this._touchstart.bind(this),s=this._touchmove.bind(this),l=this._touchend.bind(this),r=t?{passive:!1,capture:!1}:!1;a.addEventListener("touchstart",n,r),a.addEventListener("touchmove",s,r),a.addEventListener("touchend",l),a.addEventListener("touchcancel",l)}}return e.getInstance=function(){return e._instance},e.prototype._touchstart=function(t){var a=this;if(this._shouldHandle(t)){if(Date.now()-this._lastClick<e._DBLCLICK&&this._dispatchEvent(t,"dblclick",t.target)){t.cancelable&&t.preventDefault(),this._reset();return}this._reset();var n=this._closestDraggable(t.target);n&&!this._dispatchEvent(t,"mousemove",t.target)&&!this._dispatchEvent(t,"mousedown",t.target)&&(this._dragSource=n,this._ptDown=this._getPoint(t),this._lastTouch=t,t.cancelable&&t.preventDefault(),setTimeout(function(){a._dragSource==n&&a._img==null&&a._dispatchEvent(t,"contextmenu",n)&&a._reset()},e._CTXMENU),e._ISPRESSHOLDMODE&&(this._pressHoldInterval=setTimeout(function(){a._isDragEnabled=!0,a._touchmove(t)},e._PRESSHOLDAWAIT)))}},e.prototype._touchmove=function(t){if(this._shouldCancelPressHoldMove(t)){this._reset();return}if(this._shouldHandleMove(t)||this._shouldHandlePressHoldMove(t)){var a=this._getTarget(t);if(this._dispatchEvent(t,"mousemove",a)){this._lastTouch=t,t.cancelable&&t.preventDefault();return}this._dragSource&&!this._img&&this._shouldStartDragging(t)&&(this._dispatchEvent(t,"dragstart",this._dragSource),this._createImage(t),this._dispatchEvent(t,"dragenter",a)),this._img&&(this._lastTouch=t,t.cancelable&&t.preventDefault(),a!=this._lastTarget&&(this._dispatchEvent(this._lastTouch,"dragleave",this._lastTarget),this._dispatchEvent(t,"dragenter",a),this._lastTarget=a),this._moveImage(t),this._isDropZone=this._dispatchEvent(t,"dragover",a))}},e.prototype._touchend=function(t){if(this._shouldHandle(t)){if(this._dispatchEvent(this._lastTouch,"mouseup",t.target)){t.cancelable&&t.preventDefault();return}this._img||(this._dragSource=null,this._dispatchEvent(this._lastTouch,"click",t.target),this._lastClick=Date.now()),this._destroyImage(),this._dragSource&&(t.type.indexOf("cancel")<0&&this._isDropZone&&this._dispatchEvent(this._lastTouch,"drop",this._lastTarget),this._dispatchEvent(this._lastTouch,"dragend",this._dragSource),this._reset())}},e.prototype._shouldHandle=function(t){return t&&!t.defaultPrevented&&t.touches&&t.touches.length<2},e.prototype._shouldHandleMove=function(t){return!e._ISPRESSHOLDMODE&&this._shouldHandle(t)},e.prototype._shouldHandlePressHoldMove=function(t){return e._ISPRESSHOLDMODE&&this._isDragEnabled&&t&&t.touches&&t.touches.length},e.prototype._shouldCancelPressHoldMove=function(t){return e._ISPRESSHOLDMODE&&!this._isDragEnabled&&this._getDelta(t)>e._PRESSHOLDMARGIN},e.prototype._shouldStartDragging=function(t){var a=this._getDelta(t);return a>e._THRESHOLD||e._ISPRESSHOLDMODE&&a>=e._PRESSHOLDTHRESHOLD},e.prototype._reset=function(){this._destroyImage(),this._dragSource=null,this._lastTouch=null,this._lastTarget=null,this._ptDown=null,this._isDragEnabled=!1,this._isDropZone=!1,this._dataTransfer=new u,clearInterval(this._pressHoldInterval)},e.prototype._getPoint=function(t,a){return t&&t.touches&&(t=t.touches[0]),{x:a?t.pageX:t.clientX,y:a?t.pageY:t.clientY}},e.prototype._getDelta=function(t){if(e._ISPRESSHOLDMODE&&!this._ptDown)return 0;var a=this._getPoint(t);return Math.abs(a.x-this._ptDown.x)+Math.abs(a.y-this._ptDown.y)},e.prototype._getTarget=function(t){for(var a=this._getPoint(t),n=document.elementFromPoint(a.x,a.y);n&&getComputedStyle(n).pointerEvents=="none";)n=n.parentElement;return n},e.prototype._createImage=function(t){this._img&&this._destroyImage();var a=this._imgCustom||this._dragSource;if(this._img=a.cloneNode(!0),this._copyStyle(a,this._img),this._img.style.top=this._img.style.left="-9999px",!this._imgCustom){var n=a.getBoundingClientRect(),s=this._getPoint(t);this._imgOffset={x:s.x-n.left,y:s.y-n.top},this._img.style.opacity=e._OPACITY.toString()}this._moveImage(t),document.body.appendChild(this._img)},e.prototype._destroyImage=function(){this._img&&this._img.parentElement&&this._img.parentElement.removeChild(this._img),this._img=null,this._imgCustom=null},e.prototype._moveImage=function(t){var a=this;requestAnimationFrame(function(){if(a._img){var n=a._getPoint(t,!0),s=a._img.style;s.position="absolute",s.pointerEvents="none",s.zIndex="999999",s.left=Math.round(n.x-a._imgOffset.x)+"px",s.top=Math.round(n.y-a._imgOffset.y)+"px"}})},e.prototype._copyProps=function(t,a,n){for(var s=0;s<n.length;s++){var l=n[s];t[l]=a[l]}},e.prototype._copyStyle=function(t,a){if(e._rmvAtts.forEach(function(p){a.removeAttribute(p)}),t instanceof HTMLCanvasElement){var n=t,s=a;s.width=n.width,s.height=n.height,s.getContext("2d").drawImage(n,0,0)}for(var l=getComputedStyle(t),r=0;r<l.length;r++){var h=l[r];h.indexOf("transition")<0&&(a.style[h]=l[h])}a.style.pointerEvents="none";for(var r=0;r<t.children.length;r++)this._copyStyle(t.children[r],a.children[r])},e.prototype._dispatchEvent=function(t,a,n){if(t&&n){var s=document.createEvent("Event"),l=t.touches?t.touches[0]:t;return s.initEvent(a,!0,!0),s.button=0,s.which=s.buttons=1,this._copyProps(s,t,e._kbdProps),this._copyProps(s,l,e._ptProps),s.dataTransfer=this._dataTransfer,n.dispatchEvent(s),s.defaultPrevented}return!1},e.prototype._closestDraggable=function(t){for(;t;t=t.parentElement)if(t.hasAttribute("draggable")&&t.draggable)return t;return null},e}();o._instance=new o,o._THRESHOLD=5,o._OPACITY=.5,o._DBLCLICK=500,o._CTXMENU=900,o._ISPRESSHOLDMODE=!1,o._PRESSHOLDAWAIT=400,o._PRESSHOLDMARGIN=25,o._PRESSHOLDTHRESHOLD=0,o._rmvAtts="id,class,style,draggable".split(","),o._kbdProps="altKey,ctrlKey,metaKey,shiftKey".split(","),o._ptProps="pageX,pageY,clientX,clientY,screenX,screenY".split(","),i.DragDropTouch=o})(A||(A={}));const lt=f("div",{class:"q-space"}),ut=Q({name:"QSpace",setup(){return()=>lt}}),ct=()=>!0;function dt(i){const u={};return i.forEach(o=>{u[o]=ct}),u}function b(){const{emit:i,proxy:u}=j(),o=I(null);function e(){o.value.show()}function t(){o.value.hide()}function a(s){i("ok",s),t()}function n(){i("hide")}return Object.assign(u,{show:e,hide:t}),{dialogRef:o,onDialogHide:n,onDialogOK:a,onDialogCancel:t}}const N=["ok","hide"];b.emits=N;b.emitsObject=dt(N);const ft=z("div",{class:"text-h6"},"Progress",-1),ht={__name:"ProgressDialog",props:{task:{type:Object,required:!0}},emits:[...b.emits],setup(i){const u=i,o=I(u.task.performance),e=I(null),{dialogRef:t,onDialogHide:a,onDialogOK:n,onDialogCancel:s}=b(),l=v(()=>o.value===u.task.performance&&!e.value);function r(){n({performance:o.value,duration:e.value})}return(h,p)=>(_(),g(Z,{ref_key:"dialogRef",ref:t,onHide:m(a)},{default:d(()=>[c(J,{class:"q-dialog-plugin"},{default:d(()=>[c(O,null,{default:d(()=>[ft]),_:1}),c(O,null,{default:d(()=>[c(nt,{modelValue:o.value,"onUpdate:modelValue":p[0]||(p[0]=k=>o.value=k),label:"Performance",hint:"of "+i.task.target},null,8,["modelValue","hint"])]),_:1}),c(O,null,{default:d(()=>[c(st,{modelValue:e.value,"onUpdate:modelValue":p[1]||(p[1]=k=>e.value=k),label:"Time spent"},null,8,["modelValue"])]),_:1}),c(G,{align:"right"},{default:d(()=>[c(y,{flat:"",label:"Edit Task",class:"text-primary",to:{name:"task",params:{id:i.task.id}}},null,8,["to"]),c(ut),c(y,{flat:"",label:"Cancel",class:"text-primary",onClick:m(s)},null,8,["onClick"]),c(y,{disable:m(l),flat:"",label:"Submit",class:"text-primary",onClick:r},null,8,["disable"])]),_:1})]),_:1})]),_:1},8,["onHide"]))}},_t={__name:"TaskListItem",props:{task:{type:Object,required:!0}},emits:["mutate","ondragstart"],setup(i,{emit:u}){const o=i,e=it(),t=v(()=>[o.task.performance,"of",o.task.target].join(" "));function a(){e.dialog({component:ht,componentProps:{task:o.task}}).onOk(n=>{n.performance!==o.task.performance&&S.update("/tasks/"+o.task.id+"/",{performance:n.performance}).then(()=>u("mutate")),n.duration&&S.create("/times/",{task:o.task.id,start:new Date().toISOString(),end:null,duration:n.duration,description:""}).then(()=>u("mutate"))})}return(n,s)=>(_(),g(at,{clickable:""},{default:d(()=>[c(C,{thumbnail:"",style:{cursor:"grab"},draggable:"true",onDragstart:s[0]||(s[0]=l=>n.$emit("ondragstart",l,i.task)),"onTouchmove:native":s[1]||(s[1]=l=>{})},{default:d(()=>[c(H,{name:"drag_indicator"})]),_:1}),i.task.group_id?(_(),g(C,{key:0,thumbnail:""},{default:d(()=>[c(H,{name:"event_repeat"})]),_:1})):E("",!0),c(C,{onClick:a},{default:d(()=>[c(R,null,{default:d(()=>[x(q(i.task.name),1)]),_:1}),c(R,{caption:""},{default:d(()=>[x(q(m(t)),1)]),_:1})]),_:1})]),_:1}))}},mt={__name:"WeekTimelineEntry",props:{week:{type:Object,required:!0}},emits:["mutate"],setup(i,{emit:u}){const o=i,e=new Date(o.week.day),t=D.formatDate(e,"w-YYYY-Q-MMM D").split("-"),a=["Week "+t[0],t[1]+" / Q"+t[2],t[3]].join(" Â· ");function n(l,r){const h={id:r.id,day:D.getDayOfWeek(r.planned),week:t[0]};l.dataTransfer.setData("text",JSON.stringify(h)),l.dataTransfer.dropEffect="move"}function s(l){const r=JSON.parse(l.dataTransfer.getData("text"));if(r.week===t[0])return;const h=D.addToDate(e,{days:r.day-1});S.update("/tasks/"+r.id+"/",{planned:h.toISOString()}).then(()=>u("mutate"))}return(l,r)=>(_(),g(rt,{subtitle:m(a),onDragover:r[1]||(r[1]=P(()=>{},["prevent"])),onDragenter:r[2]||(r[2]=P(()=>{},["prevent"])),onDrop:r[3]||(r[3]=P(h=>s(h),["prevent"]))},{default:d(()=>[i.week.tasks&&i.week.tasks.length?(_(),g(et,{key:0},{default:d(()=>[(_(!0),L(M,null,Y(i.week.tasks,h=>(_(),g(_t,{key:h.id,task:h,onOndragstart:n,onMutate:r[0]||(r[0]=p=>l.$emit("mutate"))},null,8,["task"]))),128))]),_:1})):E("",!0)]),_:1},8,["subtitle"]))}},Tt={__name:"HomeView",setup(i){const u=D.formatDate(new Date,"YYYY-w"),{data:o,mutate:e}=S.read("/plan/");return(t,a)=>(_(),g(tt,{padding:""},{default:d(()=>[c(K,null,{default:d(()=>[c(V,null,{default:d(()=>[x("Plan")]),_:1}),c(y,{to:{name:"task",params:{id:"create"}},icon:"assignment_add",flat:"",round:""})]),_:1}),m(o)?(_(),g(ot,{key:0,layout:"dense",class:"q-px-md"},{default:d(()=>[(_(!0),L(M,null,Y(m(o),(n,s)=>(_(),L(M,{key:s},[n.day?(_(),g(mt,{key:0,color:s===m(u)?"orange":"",week:n,onMutate:m(e)},null,8,["color","week","onMutate"])):E("",!0)],64))),128))]),_:1})):E("",!0)]),_:1}))}};export{Tt as default};
