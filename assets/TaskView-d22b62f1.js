import{j as K,at as M,d as _,a3 as r,a4 as d,a5 as p,a6 as t,ae as c,a9 as l,au as w,av as V,aj as O,aw as Y,af as v,a7 as j,ax as D,ay as H,an as R}from"./index-04da890e.js";import{Q as A,a as F}from"./QToolbar-6a73b8d4.js";import{Q as G}from"./QForm-d869e7d0.js";import{Q as z,_ as E}from"./GoalSelect-fdc78ef3.js";import{u as J,d as L}from"./TaskStore-8bb55184.js";import{u as W,_ as y}from"./DateInput-1e8dc428.js";import"./QSlideTransition-beb445b7.js";function X(){return K(M)}const N={__name:"NumberInput",props:{label:{type:String,required:!0},modelValue:{type:Number,default:null}},emits:["update:modelValue"],setup(g,{emit:k}){const f=g,s=_({get(){return f.modelValue},set(u){u>=0&&k("update:modelValue",u)}});return(u,e)=>(r(),d(V,{modelValue:l(s),"onUpdate:modelValue":e[2]||(e[2]=m=>w(s)?s.value=m:null),modelModifiers:{number:!0},type:"number",min:"0",label:g.label,"stack-label":""},{append:p(()=>[t(c,{round:"",label:"-1",onClick:e[0]||(e[0]=m=>s.value--)}),t(c,{round:"",label:"+1",onClick:e[1]||(e[1]=m=>s.value++)})]),_:1},8,["modelValue","label"]))}},Z={class:"q-pa-md"},h={class:"row q-col-gutter-lg"},se={__name:"TaskView",setup(g){const k=O(),f=X(),s=J(),u=parseInt(k.params.id),{item:e,original:m,path:P,persist:Q,changed:S,remove:x,save:T,back:U}=W(u,s,{name:"",goal:null,planned:null,recurring_until:null,target:1,performance:0,done:null,description:"",performance_history:[]}),$=_(()=>!e.value.name||Q.value||!!(u&&!S(m,{...e.value}))),b=_(()=>{const n=e.value.performance_history;if(!n||!n.length)return null;const o=i=>L.formatDate(i.updated,"DD.MM.YYYY HH:mm")+" to "+i.value;let a=o(n[0]);if(n.length===1)return a;for(let i=1;i<n.length;i++)a+=", "+o(n[i]);return a}),q={type:"radio",model:"this",items:[{label:"This task",value:"this"},{label:"All tasks",value:"all"}]};function C(){P.value="recurring/"+e.value.group_id+"/"}function B(){e.value.group_id?f.dialog({title:"Delete recurring task",cancel:!0,ok:"Delete",options:q}).onOk(n=>{n==="all"&&C(),x()}):x()}function I(){e.value.group_id?f.dialog({title:"Save recurring task",cancel:!0,ok:"Save",options:q}).onOk(n=>{n==="all"&&C(),T()}):T()}return(n,o)=>(r(),d(z,{class:"q-pa-md"},{default:p(()=>[t(G,{onSubmit:R(I,["prevent"])},{default:p(()=>[t(A,null,{default:p(()=>[l(e).group_id?(r(),d(Y,{key:0,icon:"event_repeat"})):v("",!0),t(F,null,{default:p(()=>[j("Task")]),_:1}),l(u)?(r(),d(c,{key:1,type:"button",flat:"",round:"",icon:"delete",disable:l(Q),onClick:B},null,8,["disable"])):v("",!0),t(c,{type:"submit",flat:"",round:"",icon:"save",disable:l($)},null,8,["disable"]),t(c,{type:"button",flat:"",round:"",icon:"clear",onClick:l(U)},null,8,["onClick"])]),_:1}),D("div",Z,[D("div",h,[t(V,{modelValue:l(e).name,"onUpdate:modelValue":o[0]||(o[0]=a=>l(e).name=a),label:"Name","stack-label":"",autofocus:!l(u),rules:[a=>!!a||"Field is required"],class:"col-12 col-lg-6",onKeyup:H(l(U),["esc"])},null,8,["modelValue","autofocus","rules","onKeyup"]),t(E,{modelValue:l(e).goal,"onUpdate:modelValue":o[1]||(o[1]=a=>l(e).goal=a),label:"Goal","stack-label":"",class:"col-12 col-lg-6"},null,8,["modelValue"]),t(y,{modelValue:l(e).planned,"onUpdate:modelValue":o[2]||(o[2]=a=>l(e).planned=a),label:"Planned",class:"col-12 col-lg-6"},null,8,["modelValue"]),l(u)?(r(),d(y,{key:0,modelValue:l(e).done,"onUpdate:modelValue":o[3]||(o[3]=a=>l(e).done=a),label:"Done",class:"col-12 col-lg-6"},null,8,["modelValue"])):(r(),d(y,{key:1,modelValue:l(e).recurring_until,"onUpdate:modelValue":o[4]||(o[4]=a=>l(e).recurring_until=a),label:"Recurring until",class:"col-12 col-lg-6"},null,8,["modelValue"])),t(N,{modelValue:l(e).target,"onUpdate:modelValue":o[5]||(o[5]=a=>l(e).target=a),label:"Target",class:"col-12 col-lg-6"},null,8,["modelValue"]),t(N,{modelValue:l(e).performance,"onUpdate:modelValue":o[6]||(o[6]=a=>l(e).performance=a),label:"Performance",class:"col-12 col-lg-6"},null,8,["modelValue"])]),t(V,{modelValue:l(e).description,"onUpdate:modelValue":o[7]||(o[7]=a=>l(e).description=a),type:"textarea",label:"Description","stack-label":"",class:"q-pt-md"},null,8,["modelValue"]),l(b)?(r(),d(V,{key:0,modelValue:l(b),"onUpdate:modelValue":o[8]||(o[8]=a=>w(b)?b.value=a:null),type:"textarea",label:"Performance updates","stack-label":"",readonly:"",class:"q-pt-md"},null,8,["modelValue"])):v("",!0)])]),_:1},8,["onSubmit"])]),_:1}))}};export{se as default};
