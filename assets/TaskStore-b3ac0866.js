import{aJ as T,f as d,r as b}from"./index-3bd6ffe9.js";import{d as t}from"./date-a438272d.js";import{u as k,a as W}from"./GoalStore-3cc73f46.js";const B=T("TaskStore",()=>{const{data:o,refetch:m,getItem:D,createItem:h,updateItem:Y,deleteItem:w}=k("/tasks/"),u=W(),I=d(()=>o.value&&u.data?o.value.map(e=>({...e,goalName:e.goal?u.getItem(e.goal).name:null})):null),l=b({done:!0,recurring:!0,goal:null}),g=d(()=>l.value.goal?u.getBranch(l.value.goal):null);u.$onAction(({name:e,args:a})=>{e==="deleteItem"&&l.value.goal===a[0]&&(l.value.goal=null)});const c=e=>t.subtractFromDate(e,{days:t.getDayOfWeek(e)-1}),f=e=>t.formatDate(e,"YYYY-w"),v=t.startOfDate(new Date,"day"),i=c(v),y=f(v),r=d(()=>o.value?o.value.filter(e=>!(!e.planned||new Date(e.planned.slice(0,10))<i&&(l.value.done&&e.done||l.value.recurring&&e.group_id)||g.value&&!g.value.includes(e.goal))).sort((e,a)=>Date.parse(e.planned)-Date.parse(a.planned)):null),S=d(()=>{const e=(a,n,s)=>{for(;n<=s;)a[f(n)]={day:t.formatDate(n,"YYYY-MM-DD"),tasks:[]},n=t.addToDate(n,{days:7});return a};if(r.value&&r.value.length){const a=new Date(r.value[0].planned.slice(0,10)),n=t.addToDate(new Date(r.value[r.value.length-1].planned.slice(0,10)),{days:7}),s=e({},c(a),c(n));return r.value.forEach(p=>{s[f(p.planned)].tasks.push(p)}),s}return e({},i,t.addToDate(i,{days:14}))});return{data:o,refetch:m,getItem:D,createItem:h,updateItem:Y,deleteItem:w,relative:I,filter:l,currentWeek:y,calendar:S}});export{B as u};
